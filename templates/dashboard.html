<!DOCTYPE html>
<html>
<head>
    <title>ダッシュボード</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $('#food-search').on('input', function(){
                // 食品を検索するロジックを実装
                var query = $(this).val();
                if(query.length > 1){
                    $.ajax({
                        url: '/search_food',
                        method: 'GET',
                        data: {query: query},
                        success: function(response){
                            $('#food-results').html(response);
                        }
                    });
                }
            });

            // 選択された食品名を取得
            $('#food-results').on('click', '.food-item', function(){
                var selectedFood = $(this).text();
                $('#selected-food-name').val(selectedFood);
            });
        });


</script>


</head>
<body>

    <h2>その日の摂取した栄養素</h2>
   
    <ul>

    <li>エネルギー (kcal): {{ nutrients_data.Energy_kcal }}kcal</li>
    <li>タンパク質: {{ nutrients_data.Protein }} g</li>
    <li>脂質: {{ nutrients_data.Fat }} g</li>
    <li>コレステロール: {{ nutrients_data.Cholesterol }} mg</li>
    <li>炭水化物: {{ nutrients_data.Carbohydrates }} g</li>

    </ul>

    <div class="food-entry-form">
        <h2>Add Food Entry</h2>
        <form method="POST" action="/dashboard">
            <div class="form-group">
                {{ form.date.label(class="form-control-label")}}
                {{form.date(class="form-control",placeholder="Select Date")}}
            </div>
            {{ form.hidden_tag() }}
            <div class="form-group">
                <input type="text" id="food-search" placeholder="食品を検索">
                <div id="food-results"></div>
                <input type="text" id="selected-food-name" name="name" placeholder="選択された食品">
                <input type="number" id="grams" name="grams" placeholder="グラム数を入力">
            </div>
            <div class="form-group">
                {{ form.submit_entry() }}
            </div>
        </form>
    </div>

    <h2>履歴</h2>
    {% for entry in entries %}
        <div class="entry">
            <h3>{{ entry.date }}</h3>
            <p>エネルギー (kcal): <span>{{ entry.kcal }}</span></p>
            <p>タンパク質: <span>{{ entry.protein }}</span></p>
            <p>脂質: <span>{{ entry.fat }}</span></p>
            <p>コレステロール: <span>{{ entry.cholesterol }}</span></p>
            <p>炭水化物: <span>{{ entry.carbs }}</span></p>
            <ul>
            {% for food in entry.foods %}
                <li>
                    {{ food.food_name }} - {{ food.grams }} g</li>
                    <form method="GET" action="/edit_food/{{ food.id }}" style="display: inline;">
                        <button type="submit">修正</button>
                    </form>
                    <form method="POST" action="/delete_food/{{ food.id }}" style="display: inline;">
                        <button type="submit">削除</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        </div>
    {% endfor %}

    <form action="{{ url_for('main.logout') }}" method="POST">
        <button type="submit" class="btn btn-danger">Logout</button>
    </form>


</body>
</html>  

<img src="data:image/png;base64,{{ encoded_image }}" alt="Nutrient Intake Graph">

